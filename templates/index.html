<!DOCTYPE html>
<html>
<head>
<title>THKBot168 Dashboard</title>
<style>
/* ... ‡πÉ‡∏ä‡πâ CSS ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ... */
body{font-family:'Segoe UI',sans-serif;background:#f0f2f5;margin:0;padding:20px;color:#333}
/* (‡∏ï‡∏±‡∏î CSS ‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö) */
</style>
</head>
<body>
<h1>THKBot168 Dashboard (Realtime)</h1>
<div id="ip-display">IP: {{ user_ip }}</div>

<!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î -->
<div id="top-bar">
  <div class="summary-card">
    <h2>üí∞ ‡∏¢‡∏≠‡∏î Wallet ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
    <span id="wallet-info">0</span> ‡∏ö‡∏≤‡∏ó
  </div>
  <div class="summary-card">
    <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
    <table id="daily-summary"><tbody></tbody></table>
  </div>
  <div class="summary-card">
    <h2>‡∏£‡∏µ‡πÄ‡∏ã‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h2>
    <button onclick="resetApproved()">‡∏£‡∏µ‡πÄ‡∏ã‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
    <button onclick="resetCancelled()">‡∏£‡∏µ‡πÄ‡∏ã‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>
</div>

<!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ -->
<div id="dashboard">
  <div id="left-column">
    <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà (New Orders)</h2>
    <div class="scroll-box"><table id="new-orders-table"><tbody></tbody></table></div>
  </div>
  <div id="right-column">
    <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß (Approved Orders)</h2>
    <div class="scroll-box"><table id="approved-orders-table"><tbody></tbody></table></div>
  </div>
</div>
<div id="bottom-row">
  <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å (Cancelled Orders)</h2>
  <div class="scroll-box"><table id="cancelled-orders-table"><tbody></tbody></table></div>
</div>

<script>
async function fetchTransactions(){
    let resp = await fetch("/get_transactions"); 
    let data = await resp.json();
    document.getElementById("wallet-info").innerText = data.wallet_daily_total;

    // daily_summary
    let dailyBody = document.querySelector("#daily-summary tbody");
    dailyBody.innerHTML="";
    data.daily_summary.forEach(d=>{
        let row = dailyBody.insertRow();
        row.insertCell(0).innerText=d.date;
        row.insertCell(1).innerText=d.total;
    });

    // new_orders
    let newBody = document.querySelector("#new-orders-table tbody");
    newBody.innerHTML="";
    data.new_orders.forEach(tx=>{
        let row=newBody.insertRow();
        row.insertCell(0).innerText=tx.id;
        row.insertCell(1).innerText=tx.event;
        row.insertCell(2).innerText=tx.amount_str;
        row.insertCell(3).innerText=tx.name;
        row.insertCell(4).innerText=tx.time_str;
        row.insertCell(5).innerText=tx.bank;
        let cell=row.insertCell(6);
        let btnApprove=document.createElement("button");
        btnApprove.className="approve"; btnApprove.innerText="‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥";
        btnApprove.onclick=async ()=>{
            let customer_user=prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤");
            if(!customer_user) return alert("‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏¢‡∏π‡∏™‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥");
            await fetch("/approve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:tx.id,customer_user})});
            fetchTransactions();
        };
        let btnCancel=document.createElement("button");
        btnCancel.className="cancel"; btnCancel.innerText="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å";
        btnCancel.onclick=async ()=>{
            await fetch("/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:tx.id})});
            fetchTransactions();
        };
        cell.appendChild(btnApprove); cell.appendChild(btnCancel);
    });

    // approved_orders
    let approvedBody=document.querySelector("#approved-orders-table tbody");
    approvedBody.innerHTML="";
    data.approved_orders.forEach(tx=>{
        let row=approvedBody.insertRow();
        row.insertCell(0).innerText=tx.id;
        row.insertCell(1).innerText=tx.event;
        row.insertCell(2).innerText=tx.amount_str;
        row.insertCell(3).innerText=tx.name;
        row.insertCell(4).innerText=tx.time_str;
        row.insertCell(5).innerText=tx.bank;
        row.insertCell(6).innerText=tx.approver_name || "-";
        row.insertCell(7).innerText=tx.approved_time || "-";
        row.insertCell(8).innerText=tx.customer_user || "-";
        let restoreBtn=document.createElement("button");
        restoreBtn.className="restore"; restoreBtn.innerText="‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏õ‡πá‡∏ô New";
        restoreBtn.onclick=async ()=>{
            if(!confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô New?")) return;
            await fetch("/restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:tx.id})});
            fetchTransactions();
        };
        row.insertCell(9).appendChild(restoreBtn);
    });

    // cancelled_orders
    let cancelledBody=document.querySelector("#cancelled-orders-table tbody");
    cancelledBody.innerHTML="";
    data.cancelled_orders.forEach(tx=>{
        let row=cancelledBody.insertRow();
        row.insertCell(0).innerText=tx.id;
        row.insertCell(1).innerText=tx.event;
        row.insertCell(2).innerText=tx.amount_str;
        row.insertCell(3).innerText=tx.name;
        row.insertCell(4).innerText=tx.time_str;
        row.insertCell(5).innerText=tx.bank;
        row.insertCell(6).innerText=tx.canceler_name || "-";
        row.insertCell(7).innerText=tx.cancelled_time || "-";
        let restoreBtn=document.createElement("button");
        restoreBtn.className="restore"; restoreBtn.innerText="‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏õ‡πá‡∏ô New";
        restoreBtn.onclick=async ()=>{
            if(!confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô New?")) return;
            await fetch("/restore",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:tx.id})});
            fetchTransactions();
        };
        row.insertCell(8).appendChild(restoreBtn);
    });
}

async function resetApproved(){
    if(!confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) return;
    await fetch("/reset_approved",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({confirm:true})});
    fetchTransactions();
}
async function resetCancelled(){
    if(!confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) return;
    await fetch("/reset_cancelled",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({confirm:true})});
    fetchTransactions();
}

setInterval(fetchTransactions,3000);
fetchTransactions();
</script>
</body>
</html>
