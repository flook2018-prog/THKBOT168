<!DOCTYPE html>
<html>
<head>
    <title>THKBot168 Dashboard</title>
    <style>
        body{font-family:'Segoe UI',sans-serif;background:#f0f2f5;margin:0;padding:20px;color:#333}
        h1,h2{text-align:center;margin-bottom:15px}
        .top-right{position:absolute;top:10px;right:20px;font-weight:bold;color:#555}
        .scroll-box{max-height:400px;overflow-y:auto;margin-bottom:25px;background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.08);padding:10px}
        table{width:100%;border-collapse:collapse}
        th,td{padding:12px;text-align:center;font-size:1em}
        th{position:sticky;top:0;z-index:2;background:#007bff;color:white}
        tr:hover{background-color:#f1f5f9}
        button{padding:6px 12px;border:none;border-radius:6px;cursor:pointer;color:white}
        .approve-btn{background:#28a745}
        .approve-btn:hover{background:#218838}
        .cancel-btn{background:#dc3545}
        .cancel-btn:hover{background:#c82333}
    </style>
</head>
<body>
<div class="top-right">IP: {{ user_ip }}</div>
<h1>THKBot168 Dashboard</h1>
<h2>üìÖ <span id="current-datetime"></span></h2>
<h2>üí∞ ‡∏¢‡∏≠‡∏î Wallet ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: <span id="wallet-info">0</span> ‡∏ö‡∏≤‡∏ó</h2>

<h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h2>
<div class="scroll-box">
<table id="new-orders-table">
<thead>
<tr><th>ID</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ö‡∏≠‡∏£‡πå</th><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</th><th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
</thead><tbody></tbody>
</table>
</div>

<h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</h2>
<div class="scroll-box">
<table id="approved-orders-table">
<thead>
<tr><th>ID</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ö‡∏≠‡∏£‡πå</th><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</th><th>‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</th><th>‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</th></tr>
</thead><tbody></tbody>
</table>
</div>

<h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</h2>
<div class="scroll-box">
<table id="cancelled-orders-table">
<thead>
<tr><th>ID</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏ä‡∏∑‡πà‡∏≠/‡πÄ‡∏ö‡∏≠‡∏£‡πå</th><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</th><th>‡πÄ‡∏ß‡∏•‡∏≤ Cancel</th></tr>
</thead><tbody></tbody>
</table>
</div>

<h2>‡∏¢‡∏≠‡∏î Wallet ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
<div class="scroll-box">
<table id="daily-summary-table">
<thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)</th></tr></thead><tbody></tbody>
</table>
</div>

<script>
function updateCurrentTime(){
    document.getElementById("current-datetime").innerText=new Date().toLocaleString('en-GB',{hour12:false})
}
setInterval(updateCurrentTime,1000);updateCurrentTime();

async function fetchTransactions(){
    try{
        let resp=await fetch("/get_transactions");let data=await resp.json();
        document.getElementById("wallet-info").innerText=data.wallet_daily_total;

        let newTable=document.querySelector("#new-orders-table tbody");newTable.innerHTML="";
        data.new_orders.forEach(tx=>{
            let row=newTable.insertRow();
            row.insertCell(0).innerText=tx.id;
            row.insertCell(1).innerText=tx.event;
            row.insertCell(2).innerText=tx.amount_str;
            row.insertCell(3).innerText=tx.name;
            row.insertCell(4).innerText=tx.time_str;
            row.insertCell(5).innerText=tx.bank;
            let btnCell=row.insertCell(6);
            let approve=document.createElement("button");
            approve.innerText="‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥";
            approve.className="approve-btn";
            approve.onclick=async ()=>{await fetch("/approve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:tx.id})});fetchTransactions()};
            let cancel=document.createElement("button");
            cancel.innerText="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å";
            cancel.className="cancel-btn";
            cancel.onclick=async ()=>{await fetch("/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:tx.id})});fetchTransactions()};
            btnCell.appendChild(approve);
            btnCell.appendChild(cancel);
        });

        let approvedTable=document.querySelector("#approved-orders-table tbody");approvedTable.innerHTML="";
        data.approved_orders.forEach(tx=>{
            let row=approvedTable.insertRow();
            row.insertCell(0).innerText=tx.id;
            row.insertCell(1).innerText=tx.event;
            row.insertCell(2).innerText=tx.amount_str;
            row.insertCell(3).innerText=tx.name;
            row.insertCell(4).innerText=tx.time_str;
            row.insertCell(5).innerText=tx.bank;
            row.insertCell(6).innerText=tx.approver_name;
            row.insertCell(7).innerText=tx.approved_time || "-";
        });

        let cancelTable=document.querySelector("#cancelled-orders-table tbody");cancelTable.innerHTML="";
        data.cancelled_orders.forEach(tx=>{
            let row=cancelTable.insertRow();
            row.insertCell(0).innerText=tx.id;
            row.insertCell(1).innerText=tx.event;
            row.insertCell(2).innerText=tx.amount_str;
            row.insertCell(3).innerText=tx.name;
            row.insertCell(4).innerText=tx.time_str;
            row.insertCell(5).innerText=tx.bank;
            row.insertCell(6).innerText=tx.cancelled_time || "-";
        });

        let dailyTable=document.querySelector("#daily-summary-table tbody");dailyTable.innerHTML="";
        data.daily_summary.forEach(day=>{
            let row=dailyTable.insertRow();
            row.insertCell(0).innerText=day.date;
            row.insertCell(1).innerText=day.total;
        });
    }catch(e){console.error("fetch error:",e)}
}
setInterval(fetchTransactions,3000);
fetchTransactions();
</script>
</body>
</html>
